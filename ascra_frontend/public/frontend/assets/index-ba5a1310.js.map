{"version":3,"mappings":"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","names":["_openBlock","_createElementBlock","userResource","createResource","error","router","sessionUser","_sessionUser","session","reactive","email","password","data","computed","routes","__vitePreload","createRouter","createWebHistory","to","from","next","__async","isLoggedIn","requiresAuth","socket","initSocket","host","siteName","port","socketio_port","url","io","globalComponents","Button","TextInput","Input","FormControl","ErrorMessage","Dialog","Alert","Badge","app","createApp","App","setConfig","frappeRequest","resourcesPlugin","pageMetaPlugin","key"],"sources":["../../../../frontend/src/App.vue","../../../../frontend/src/data/user.js","../../../../frontend/src/data/session.js","../../../../frontend/src/router.js","../../../../frontend/src/socket.js","../../../../frontend/src/main.js"],"sourcesContent":["<template>\n  <div>\n    <router-view />\n  </div>\n</template>\n","import router from \"@/router\"\nimport { createResource } from \"frappe-ui\"\n\nexport const userResource = createResource({\n\turl: \"frappe.auth.get_logged_user\",\n\tcache: \"User\",\n\tonError(error) {\n\t\tif (error && error.exc_type === \"AuthenticationError\") {\n\t\t\trouter.push({ name: \"LoginPage\" })\n\t\t}\n\t},\n})\n","import router from \"@/router\"\nimport { createResource } from \"frappe-ui\"\nimport { computed, reactive } from \"vue\"\n\nimport { userResource } from \"./user\"\n\nexport function sessionUser() {\n\tconst cookies = new URLSearchParams(document.cookie.split(\"; \").join(\"&\"))\n\tlet _sessionUser = cookies.get(\"user_id\")\n\tif (_sessionUser === \"Guest\") {\n\t\t_sessionUser = null\n\t}\n\treturn _sessionUser\n}\n\nexport const session = reactive({\n\tlogin: createResource({\n\t\turl: \"login\",\n\t\tmakeParams({ email, password }) {\n\t\t\treturn {\n\t\t\t\tusr: email,\n\t\t\t\tpwd: password,\n\t\t\t}\n\t\t},\n\t\tonSuccess(data) {\n\t\t\tuserResource.reload()\n\t\t\tsession.user = sessionUser()\n\t\t\tsession.login.reset()\n\t\t\t// Redirect to dashboard for logged-in users\n\t\t\trouter.replace(\"/dashboard\")\n\t\t},\n\t}),\n\tlogout: createResource({\n\t\turl: \"logout\",\n\t\tonSuccess() {\n\t\t\tuserResource.reset()\n\t\t\tsession.user = sessionUser()\n\t\t\trouter.replace({ name: \"Login\" })\n\t\t},\n\t}),\n\tuser: sessionUser(),\n\tisLoggedIn: computed(() => !!session.user),\n})\n","import { userResource } from \"@/data/user\"\nimport { createRouter, createWebHistory } from \"vue-router\"\nimport { session } from \"./data/session\"\n\nconst routes = [\n\t{\n\t\tpath: \"/\",\n\t\tname: \"Home\",\n\t\tcomponent: () => import(\"@/pages/Home.vue\"),\n\t\tmeta: { requiresAuth: false }\n\t},\n\t{\n\t\tname: \"Login\",\n\t\tpath: \"/account/login\",\n\t\tcomponent: () => import(\"@/pages/Login.vue\"),\n\t\tmeta: { requiresAuth: false }\n\t},\n\t{\n\t\tname: \"Signup\",\n\t\tpath: \"/account/signup\",\n\t\tcomponent: () => import(\"@/pages/Signup.vue\"),\n\t\tmeta: { requiresAuth: false }\n\t},\n\t{\n\t\tname: \"Dashboard\",\n\t\tpath: \"/dashboard\",\n\t\tcomponent: () => import(\"@/pages/Dashboard.vue\"),\n\t\tmeta: { requiresAuth: true }\n\t},\n\t{\n\t\tname: \"EmployeeDashboard\",\n\t\tpath: \"/employee-dashboard\",\n\t\tcomponent: () => import(\"@/pages/EmployeeDashboard.vue\"),\n\t\tmeta: { requiresAuth: true, requiresEmployeeRole: true }\n\t},\n]\n\nconst router = createRouter({\n\thistory: createWebHistory(\"/frontend\"),\n\troutes,\n})\n\nrouter.beforeEach(async (to, from, next) => {\n\tlet isLoggedIn = session.isLoggedIn\n\ttry {\n\t\tawait userResource.promise\n\t} catch (error) {\n\t\tisLoggedIn = false\n\t}\n\n\t// Check if route requires authentication\n\tconst requiresAuth = to.meta.requiresAuth\n\n\tif (to.name === \"Login\" && isLoggedIn) {\n\t\t// Redirect logged-in users away from login page to dashboard\n\t\tnext({ name: \"Dashboard\" })\n\t} else if (requiresAuth && !isLoggedIn) {\n\t\t// Redirect unauthenticated users to login for protected routes\n\t\tnext({ name: \"Login\" })\n\t} else {\n\t\t// Allow navigation\n\t\tnext()\n\t}\n})\n\nexport default router\n","import { io } from \"socket.io-client\"\nimport { socketio_port } from \"../../../../sites/common_site_config.json\"\n\nlet socket = null\nexport function initSocket() {\n\tconst host = window.location.hostname\n\tconst siteName = window.site_name\n\tconst port = window.location.port ? `:${socketio_port}` : \"\"\n\tconst protocol = port ? \"http\" : \"https\"\n\tconst url = `${protocol}://${host}${port}/${siteName}`\n\n\tsocket = io(url, {\n\t\twithCredentials: true,\n\t\treconnectionAttempts: 5,\n\t})\n\treturn socket\n}\n\nexport function useSocket() {\n\treturn socket\n}\n","import { createApp } from \"vue\"\n\nimport App from \"./App.vue\"\nimport router from \"./router\"\nimport { initSocket } from \"./socket\"\n\nimport {\n\tAlert,\n\tBadge,\n\tButton,\n\tDialog,\n\tErrorMessage,\n\tFormControl,\n\tInput,\n\tTextInput,\n\tfrappeRequest,\n\tpageMetaPlugin,\n\tresourcesPlugin,\n\tsetConfig,\n} from \"frappe-ui\"\n\nimport \"./index.css\"\n\nconst globalComponents = {\n\tButton,\n\tTextInput,\n\tInput,\n\tFormControl,\n\tErrorMessage,\n\tDialog,\n\tAlert,\n\tBadge,\n}\n\nconst app = createApp(App)\n\nsetConfig(\"resourceFetcher\", frappeRequest)\n\napp.use(router)\napp.use(resourcesPlugin)\napp.use(pageMetaPlugin)\n\nconst socket = initSocket()\napp.config.globalProperties.$socket = socket\n\nfor (const key in globalComponents) {\n\tapp.component(key, globalComponents[key])\n}\n\napp.mount(\"#app\")\n"],"file":"assets/index-ba5a1310.js"}